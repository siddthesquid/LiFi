% this writes a file suitable for USRP transmission. The data is in x_tx
% x_tx = ones(100000, 1);
% x_tx(1:20000) = x_tx(1:20000)*0.5;
% x_tx(20001:40000) = x_tx(20001:40000)*-0.5;
% x_tx(40001:60000) = x_tx(40001:60000)*0.5;
% x_tx(60001:80000) = x_tx(60001:80000)*-0.5;
% x_tx(80001:100000) = x_tx(80001:100000)*0.5;

%long
% x_tx = ones(1000000, 1);
% x_tx(1:200000) = x_tx(1:200000)*0.5;
% x_tx(200001:400000) = x_tx(200001:400000)*-0.5;
% x_tx(400001:600000) = x_tx(400001:600000)*0.5;
% x_tx(600001:800000) = x_tx(600001:800000)*-0.5;
% x_tx(800001:1000000) = x_tx(800001:1000000)*0.5;
% 
% x_tx1 = ones(1000, 1);
% x_tx1(1:2:end) = 0.5;
% x_tx1(2:2:end) = -0.5;

% x_start= [0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5,
%     0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5,
%     0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5,
%     0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5,
%     0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5,
%     0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5,
%     0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5,
%     0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5,
%     0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5,
%     0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5,
%     0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5,
%     0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, -0.5];
% x_start = vecDup(x_start, 1000, 1);
% padding = zeros(1, 30000);
% x_tx = horzcat(padding, x_start);
%plot(x_tx)

x_tx = randn(100000, 1)
x_tx = 0.2*x_tx
plot(x_tx)
figure;
plot(x);

% figure;
% plot(x_tx);
%% Actual
% samps = 10; %number of data pts per pulse
% p = ones(samps, 1); %pulse, could turn into raised cosine
% zeroPad = 1000000;
% numBits = 1e4;
% 
% padding = zeros(1,zeroPad);
% randn('seed', 1234);
% bits = sign(randn(numBits, 1));
% bits = [1 ; bits];
% tmp = upsample(bits, 10); %how far apart pulses are
% x_tx = conv(tmp, p);
% x_tx = transpose(x_tx);
% 
% 
% x_tx = [padding x_tx padding];
%% lol
%x_tx = SquareWave(300000, 50, 1000);

%x_tx = ExpSquareWave(30000, 50, 10);
plot(x_tx);
f1 = fopen('4PAMCF0SR10M_TH.dat','w');

x_tmp = zeros(length(x_tx)*2,1);
x_tmp(1:2:end) = real(x_tx);
figure;
plot(x_tmp);

fwrite(f1, x_tx, 'float32');

fclose(f1);